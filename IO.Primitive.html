<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>IO.Primitive</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- The Agda standard library</a>
<a id="103" class="Comment">--</a>
<a id="106" class="Comment">-- Primitive IO: simple bindings to Haskell types and functions</a>
<a id="170" class="Comment">------------------------------------------------------------------------</a>

<a id="244" class="Symbol">{-#</a> <a id="248" class="Keyword">OPTIONS</a> <a id="256" class="Pragma">--without-K</a> <a id="268" class="Symbol">#-}</a>

<a id="273" class="Keyword">module</a> <a id="280" href="IO.Primitive.html" class="Module">IO.Primitive</a> <a id="293" class="Keyword">where</a>

<a id="300" class="Keyword">open</a> <a id="305" class="Keyword">import</a> <a id="312" href="Codata.Musical.Costring.html" class="Module">Codata.Musical.Costring</a>
<a id="336" class="Keyword">open</a> <a id="341" class="Keyword">import</a> <a id="348" href="Data.Char.Base.html" class="Module">Data.Char.Base</a>
<a id="363" class="Keyword">open</a> <a id="368" class="Keyword">import</a> <a id="375" href="Data.String.Base.html" class="Module">Data.String.Base</a>
<a id="392" class="Keyword">open</a> <a id="397" class="Keyword">import</a> <a id="404" href="Foreign.Haskell.html" class="Module">Foreign.Haskell</a>

<a id="421" class="Comment">------------------------------------------------------------------------</a>
<a id="494" class="Comment">-- The IO monad</a>

<a id="511" class="Keyword">open</a> <a id="516" class="Keyword">import</a> <a id="523" href="Agda.Builtin.IO.html" class="Module">Agda.Builtin.IO</a> <a id="539" class="Keyword">public</a> <a id="546" class="Keyword">using</a> <a id="552" class="Symbol">(</a><a id="553" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a><a id="555" class="Symbol">)</a>

<a id="558" class="Keyword">infixl</a> <a id="565" class="Number">1</a> <a id="567" href="IO.Primitive.html#626" class="Postulate Operator">_&gt;&gt;=_</a>

<a id="574" class="Keyword">postulate</a>
  <a id="return"></a><a id="586" href="IO.Primitive.html#586" class="Postulate">return</a> <a id="593" class="Symbol">:</a> <a id="595" class="Symbol">∀</a> <a id="597" class="Symbol">{</a><a id="598" href="IO.Primitive.html#598" class="Bound">a</a><a id="599" class="Symbol">}</a> <a id="601" class="Symbol">{</a><a id="602" href="IO.Primitive.html#602" class="Bound">A</a> <a id="604" class="Symbol">:</a> <a id="606" class="PrimitiveType">Set</a> <a id="610" href="IO.Primitive.html#598" class="Bound">a</a><a id="611" class="Symbol">}</a> <a id="613" class="Symbol">→</a> <a id="615" href="IO.Primitive.html#602" class="Bound">A</a> <a id="617" class="Symbol">→</a> <a id="619" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="622" href="IO.Primitive.html#602" class="Bound">A</a>
  <a id="_&gt;&gt;=_"></a><a id="626" href="IO.Primitive.html#626" class="Postulate Operator">_&gt;&gt;=_</a>  <a id="633" class="Symbol">:</a> <a id="635" class="Symbol">∀</a> <a id="637" class="Symbol">{</a><a id="638" href="IO.Primitive.html#638" class="Bound">a</a> <a id="640" href="IO.Primitive.html#640" class="Bound">b</a><a id="641" class="Symbol">}</a> <a id="643" class="Symbol">{</a><a id="644" href="IO.Primitive.html#644" class="Bound">A</a> <a id="646" class="Symbol">:</a> <a id="648" class="PrimitiveType">Set</a> <a id="652" href="IO.Primitive.html#638" class="Bound">a</a><a id="653" class="Symbol">}</a> <a id="655" class="Symbol">{</a><a id="656" href="IO.Primitive.html#656" class="Bound">B</a> <a id="658" class="Symbol">:</a> <a id="660" class="PrimitiveType">Set</a> <a id="664" href="IO.Primitive.html#640" class="Bound">b</a><a id="665" class="Symbol">}</a> <a id="667" class="Symbol">→</a> <a id="669" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="672" href="IO.Primitive.html#644" class="Bound">A</a> <a id="674" class="Symbol">→</a> <a id="676" class="Symbol">(</a><a id="677" href="IO.Primitive.html#644" class="Bound">A</a> <a id="679" class="Symbol">→</a> <a id="681" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="684" href="IO.Primitive.html#656" class="Bound">B</a><a id="685" class="Symbol">)</a> <a id="687" class="Symbol">→</a> <a id="689" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="692" href="IO.Primitive.html#656" class="Bound">B</a>

<a id="695" class="Symbol">{-#</a> <a id="699" class="Keyword">COMPILE</a> <a id="707" class="Pragma">GHC</a> <a id="711" href="IO.Primitive.html#586" class="Postulate">return</a> <a id="718" class="Pragma">=</a> <a id="720" class="Pragma">\_</a> <a id="723" class="Pragma">_</a> <a id="725" class="Pragma">-&gt;</a> <a id="728" class="Pragma">return</a>    <a id="738" class="Symbol">#-}</a>
<a id="742" class="Symbol">{-#</a> <a id="746" class="Keyword">COMPILE</a> <a id="754" class="Pragma">GHC</a> <a id="758" href="IO.Primitive.html#626" class="Postulate Operator">_&gt;&gt;=_</a>  <a id="765" class="Pragma">=</a> <a id="767" class="Pragma">\_</a> <a id="770" class="Pragma">_</a> <a id="772" class="Pragma">_</a> <a id="774" class="Pragma">_</a> <a id="776" class="Pragma">-&gt;</a> <a id="779" class="Pragma">(&gt;&gt;=)</a> <a id="785" class="Symbol">#-}</a>
<a id="789" class="Symbol">{-#</a> <a id="793" class="Keyword">COMPILE</a> <a id="801" class="Pragma">UHC</a> <a id="805" href="IO.Primitive.html#586" class="Postulate">return</a> <a id="812" class="Pragma">=</a> <a id="814" class="Pragma">\_</a> <a id="817" class="Pragma">_</a> <a id="819" class="Pragma">x</a> <a id="821" class="Pragma">-&gt;</a> <a id="824" class="Pragma">UHC.Agda.Builtins.primReturn</a> <a id="853" class="Pragma">x</a> <a id="855" class="Symbol">#-}</a>
<a id="859" class="Symbol">{-#</a> <a id="863" class="Keyword">COMPILE</a> <a id="871" class="Pragma">UHC</a> <a id="875" href="IO.Primitive.html#626" class="Postulate Operator">_&gt;&gt;=_</a>  <a id="882" class="Pragma">=</a> <a id="884" class="Pragma">\_</a> <a id="887" class="Pragma">_</a> <a id="889" class="Pragma">_</a> <a id="891" class="Pragma">_</a> <a id="893" class="Pragma">x</a> <a id="895" class="Pragma">y</a> <a id="897" class="Pragma">-&gt;</a> <a id="900" class="Pragma">UHC.Agda.Builtins.primBind</a> <a id="927" class="Pragma">x</a> <a id="929" class="Pragma">y</a> <a id="931" class="Symbol">#-}</a>

<a id="936" class="Comment">------------------------------------------------------------------------</a>
<a id="1009" class="Comment">-- Simple lazy IO</a>

<a id="1028" class="Comment">-- Note that the functions below produce commands which, when</a>
<a id="1090" class="Comment">-- executed, may raise exceptions.</a>

<a id="1126" class="Comment">-- Note also that the semantics of these functions depends on the</a>
<a id="1192" class="Comment">-- version of the Haskell base library. If the version is 4.2.0.0 (or</a>
<a id="1262" class="Comment">-- later?), then the functions use the character encoding specified by</a>
<a id="1333" class="Comment">-- the locale. For older versions of the library (going back to at</a>
<a id="1400" class="Comment">-- least version 3) the functions use ISO-8859-1.</a>

<a id="1451" class="Symbol">{-#</a> <a id="1455" class="Keyword">FOREIGN</a> <a id="1463" class="Pragma">GHC</a> <a id="1467" class="Pragma">import</a> <a id="1474" class="Pragma">qualified</a> <a id="1484" class="Pragma">Data.Text</a>    <a id="1497" class="Symbol">#-}</a>
<a id="1501" class="Symbol">{-#</a> <a id="1505" class="Keyword">FOREIGN</a> <a id="1513" class="Pragma">GHC</a> <a id="1517" class="Pragma">import</a> <a id="1524" class="Pragma">qualified</a> <a id="1534" class="Pragma">Data.Text.IO</a> <a id="1547" class="Symbol">#-}</a>
<a id="1551" class="Symbol">{-#</a> <a id="1555" class="Keyword">FOREIGN</a> <a id="1563" class="Pragma">GHC</a> <a id="1567" class="Pragma">import</a> <a id="1574" class="Pragma">qualified</a> <a id="1584" class="Pragma">System.IO</a>    <a id="1597" class="Symbol">#-}</a>
<a id="1601" class="Symbol">{-#</a> <a id="1605" class="Keyword">FOREIGN</a> <a id="1613" class="Pragma">GHC</a> <a id="1617" class="Pragma">import</a> <a id="1624" class="Pragma">qualified</a> <a id="1634" class="Pragma">Control.Exception</a> <a id="1652" class="Symbol">#-}</a>

<a id="1657" class="Keyword">postulate</a>
  <a id="getContents"></a><a id="1669" href="IO.Primitive.html#1669" class="Postulate">getContents</a> <a id="1681" class="Symbol">:</a> <a id="1683" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="1686" href="Codata.Musical.Costring.html#468" class="Function">Costring</a>
  <a id="readFile"></a><a id="1697" href="IO.Primitive.html#1697" class="Postulate">readFile</a>    <a id="1709" class="Symbol">:</a> <a id="1711" href="Agda.Builtin.String.html#206" class="Postulate">String</a> <a id="1718" class="Symbol">→</a> <a id="1720" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="1723" href="Codata.Musical.Costring.html#468" class="Function">Costring</a>
  <a id="writeFile"></a><a id="1734" href="IO.Primitive.html#1734" class="Postulate">writeFile</a>   <a id="1746" class="Symbol">:</a> <a id="1748" href="Agda.Builtin.String.html#206" class="Postulate">String</a> <a id="1755" class="Symbol">→</a> <a id="1757" href="Codata.Musical.Costring.html#468" class="Function">Costring</a> <a id="1766" class="Symbol">→</a> <a id="1768" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="1771" href="Foreign.Haskell.html#343" class="Datatype">Unit</a>
  <a id="appendFile"></a><a id="1778" href="IO.Primitive.html#1778" class="Postulate">appendFile</a>  <a id="1790" class="Symbol">:</a> <a id="1792" href="Agda.Builtin.String.html#206" class="Postulate">String</a> <a id="1799" class="Symbol">→</a> <a id="1801" href="Codata.Musical.Costring.html#468" class="Function">Costring</a> <a id="1810" class="Symbol">→</a> <a id="1812" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="1815" href="Foreign.Haskell.html#343" class="Datatype">Unit</a>
  <a id="putStr"></a><a id="1822" href="IO.Primitive.html#1822" class="Postulate">putStr</a>      <a id="1834" class="Symbol">:</a> <a id="1836" href="Codata.Musical.Costring.html#468" class="Function">Costring</a> <a id="1845" class="Symbol">→</a> <a id="1847" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="1850" href="Foreign.Haskell.html#343" class="Datatype">Unit</a>
  <a id="putStrLn"></a><a id="1857" href="IO.Primitive.html#1857" class="Postulate">putStrLn</a>    <a id="1869" class="Symbol">:</a> <a id="1871" href="Codata.Musical.Costring.html#468" class="Function">Costring</a> <a id="1880" class="Symbol">→</a> <a id="1882" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="1885" href="Foreign.Haskell.html#343" class="Datatype">Unit</a>

  <a id="1893" class="Comment">-- Reads a finite file. Raises an exception if the file path refers</a>
  <a id="1963" class="Comment">-- to a non-physical file (like &quot;/dev/zero&quot;).</a>

  <a id="readFiniteFile"></a><a id="2012" href="IO.Primitive.html#2012" class="Postulate">readFiniteFile</a> <a id="2027" class="Symbol">:</a> <a id="2029" href="Agda.Builtin.String.html#206" class="Postulate">String</a> <a id="2036" class="Symbol">→</a> <a id="2038" href="Agda.Builtin.IO.html#111" class="Postulate">IO</a> <a id="2041" href="Agda.Builtin.String.html#206" class="Postulate">String</a>

<a id="2049" class="Symbol">{-#</a> <a id="2053" class="Keyword">FOREIGN</a> <a id="2061" class="Pragma">GHC</a>
  <a id="2067" class="Pragma">readFiniteFile</a> <a id="2082" class="Pragma">::</a> <a id="2085" class="Pragma">Data.Text.Text</a> <a id="2100" class="Pragma">-&gt;</a> <a id="2103" class="Pragma">IO</a> <a id="2106" class="Pragma">Data.Text.Text</a>
  <a id="2123" class="Pragma">readFiniteFile</a> <a id="2138" class="Pragma">f</a> <a id="2140" class="Pragma">=</a> <a id="2142" class="Pragma">do</a>
    <a id="2149" class="Pragma">h</a> <a id="2151" class="Pragma">&lt;-</a> <a id="2154" class="Pragma">System.IO.openFile</a> <a id="2173" class="Pragma">(Data.Text.unpack</a> <a id="2191" class="Pragma">f)</a> <a id="2194" class="Pragma">System.IO.ReadMode</a>
    <a id="2217" class="Pragma">Control.Exception.bracketOnError</a> <a id="2250" class="Pragma">(return</a> <a id="2258" class="Pragma">())</a> <a id="2262" class="Pragma">(\_</a> <a id="2266" class="Pragma">-&gt;</a> <a id="2269" class="Pragma">System.IO.hClose</a> <a id="2286" class="Pragma">h)</a>
                                                 <a id="2338" class="Pragma">(\_</a> <a id="2342" class="Pragma">-&gt;</a> <a id="2345" class="Pragma">System.IO.hFileSize</a> <a id="2365" class="Pragma">h)</a>
    <a id="2372" class="Pragma">Data.Text.IO.hGetContents</a> <a id="2398" class="Pragma">h</a>

  <a id="2403" class="Pragma">fromColist</a> <a id="2414" class="Pragma">::</a> <a id="2417" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.AgdaColist</a> <a id="2463" class="Pragma">a</a> <a id="2465" class="Pragma">-&gt;</a> <a id="2468" class="Pragma">[a]</a>
  <a id="2474" class="Pragma">fromColist</a> <a id="2485" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.Nil</a>         <a id="2532" class="Pragma">=</a> <a id="2534" class="Pragma">[]</a>
  <a id="2539" class="Pragma">fromColist</a> <a id="2550" class="Pragma">(MAlonzo.Code.Codata.Musical.Colist.Cons</a> <a id="2591" class="Pragma">x</a> <a id="2593" class="Pragma">xs)</a> <a id="2597" class="Pragma">=</a>
    <a id="2603" class="Pragma">x</a> <a id="2605" class="Pragma">:</a> <a id="2607" class="Pragma">fromColist</a> <a id="2618" class="Pragma">(MAlonzo.RTE.flat</a> <a id="2636" class="Pragma">xs)</a>

  <a id="2643" class="Pragma">toColist</a> <a id="2652" class="Pragma">::</a> <a id="2655" class="Pragma">[a]</a> <a id="2659" class="Pragma">-&gt;</a> <a id="2662" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.AgdaColist</a> <a id="2708" class="Pragma">a</a>
  <a id="2712" class="Pragma">toColist</a> <a id="2721" class="Pragma">[]</a>       <a id="2730" class="Pragma">=</a> <a id="2732" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.Nil</a>
  <a id="2773" class="Pragma">toColist</a> <a id="2782" class="Pragma">(x</a> <a id="2785" class="Pragma">:</a> <a id="2787" class="Pragma">xs)</a> <a id="2791" class="Pragma">=</a>
    <a id="2797" class="Pragma">MAlonzo.Code.Codata.Musical.Colist.Cons</a> <a id="2837" class="Pragma">x</a> <a id="2839" class="Pragma">(MAlonzo.RTE.Sharp</a> <a id="2858" class="Pragma">(toColist</a> <a id="2868" class="Pragma">xs))</a>
<a id="2873" class="Symbol">#-}</a>

<a id="2878" class="Symbol">{-#</a> <a id="2882" class="Keyword">COMPILE</a> <a id="2890" class="Pragma">GHC</a> <a id="2894" href="IO.Primitive.html#1669" class="Postulate">getContents</a>    <a id="2909" class="Pragma">=</a> <a id="2911" class="Pragma">fmap</a> <a id="2916" class="Pragma">toColist</a> <a id="2925" class="Pragma">getContents</a>                          <a id="2962" class="Symbol">#-}</a>
<a id="2966" class="Symbol">{-#</a> <a id="2970" class="Keyword">COMPILE</a> <a id="2978" class="Pragma">GHC</a> <a id="2982" href="IO.Primitive.html#1697" class="Postulate">readFile</a>       <a id="2997" class="Pragma">=</a> <a id="2999" class="Pragma">fmap</a> <a id="3004" class="Pragma">toColist</a> <a id="3013" class="Pragma">.</a> <a id="3015" class="Pragma">readFile</a> <a id="3024" class="Pragma">.</a> <a id="3026" class="Pragma">Data.Text.unpack</a>        <a id="3050" class="Symbol">#-}</a>
<a id="3054" class="Symbol">{-#</a> <a id="3058" class="Keyword">COMPILE</a> <a id="3066" class="Pragma">GHC</a> <a id="3070" href="IO.Primitive.html#1734" class="Postulate">writeFile</a>      <a id="3085" class="Pragma">=</a> <a id="3087" class="Pragma">\x</a> <a id="3090" class="Pragma">-&gt;</a> <a id="3093" class="Pragma">writeFile</a> <a id="3103" class="Pragma">(Data.Text.unpack</a> <a id="3121" class="Pragma">x)</a> <a id="3124" class="Pragma">.</a> <a id="3126" class="Pragma">fromColist</a>  <a id="3138" class="Symbol">#-}</a>
<a id="3142" class="Symbol">{-#</a> <a id="3146" class="Keyword">COMPILE</a> <a id="3154" class="Pragma">GHC</a> <a id="3158" href="IO.Primitive.html#1778" class="Postulate">appendFile</a>     <a id="3173" class="Pragma">=</a> <a id="3175" class="Pragma">\x</a> <a id="3178" class="Pragma">-&gt;</a> <a id="3181" class="Pragma">appendFile</a> <a id="3192" class="Pragma">(Data.Text.unpack</a> <a id="3210" class="Pragma">x)</a> <a id="3213" class="Pragma">.</a> <a id="3215" class="Pragma">fromColist</a> <a id="3226" class="Symbol">#-}</a>
<a id="3230" class="Symbol">{-#</a> <a id="3234" class="Keyword">COMPILE</a> <a id="3242" class="Pragma">GHC</a> <a id="3246" href="IO.Primitive.html#1822" class="Postulate">putStr</a>         <a id="3261" class="Pragma">=</a> <a id="3263" class="Pragma">putStr</a> <a id="3270" class="Pragma">.</a> <a id="3272" class="Pragma">fromColist</a>                                <a id="3314" class="Symbol">#-}</a>
<a id="3318" class="Symbol">{-#</a> <a id="3322" class="Keyword">COMPILE</a> <a id="3330" class="Pragma">GHC</a> <a id="3334" href="IO.Primitive.html#1857" class="Postulate">putStrLn</a>       <a id="3349" class="Pragma">=</a> <a id="3351" class="Pragma">putStrLn</a> <a id="3360" class="Pragma">.</a> <a id="3362" class="Pragma">fromColist</a>                              <a id="3402" class="Symbol">#-}</a>
<a id="3406" class="Symbol">{-#</a> <a id="3410" class="Keyword">COMPILE</a> <a id="3418" class="Pragma">GHC</a> <a id="3422" href="IO.Primitive.html#2012" class="Postulate">readFiniteFile</a> <a id="3437" class="Pragma">=</a> <a id="3439" class="Pragma">readFiniteFile</a>                        <a id="3477" class="Symbol">#-}</a>
<a id="3481" class="Symbol">{-#</a> <a id="3485" class="Keyword">COMPILE</a> <a id="3493" class="Pragma">UHC</a> <a id="3497" href="IO.Primitive.html#1669" class="Postulate">getContents</a>    <a id="3512" class="Pragma">=</a> <a id="3514" class="Pragma">UHC.Agda.Builtins.primGetContents</a>     <a id="3552" class="Symbol">#-}</a>
<a id="3556" class="Symbol">{-#</a> <a id="3560" class="Keyword">COMPILE</a> <a id="3568" class="Pragma">UHC</a> <a id="3572" href="IO.Primitive.html#1697" class="Postulate">readFile</a>       <a id="3587" class="Pragma">=</a> <a id="3589" class="Pragma">UHC.Agda.Builtins.primReadFile</a>        <a id="3627" class="Symbol">#-}</a>
<a id="3631" class="Symbol">{-#</a> <a id="3635" class="Keyword">COMPILE</a> <a id="3643" class="Pragma">UHC</a> <a id="3647" href="IO.Primitive.html#1734" class="Postulate">writeFile</a>      <a id="3662" class="Pragma">=</a> <a id="3664" class="Pragma">UHC.Agda.Builtins.primWriteFile</a>       <a id="3702" class="Symbol">#-}</a>
<a id="3706" class="Symbol">{-#</a> <a id="3710" class="Keyword">COMPILE</a> <a id="3718" class="Pragma">UHC</a> <a id="3722" href="IO.Primitive.html#1778" class="Postulate">appendFile</a>     <a id="3737" class="Pragma">=</a> <a id="3739" class="Pragma">UHC.Agda.Builtins.primAppendFile</a>      <a id="3777" class="Symbol">#-}</a>
<a id="3781" class="Symbol">{-#</a> <a id="3785" class="Keyword">COMPILE</a> <a id="3793" class="Pragma">UHC</a> <a id="3797" href="IO.Primitive.html#1822" class="Postulate">putStr</a>         <a id="3812" class="Pragma">=</a> <a id="3814" class="Pragma">UHC.Agda.Builtins.primPutStr</a>          <a id="3852" class="Symbol">#-}</a>
<a id="3856" class="Symbol">{-#</a> <a id="3860" class="Keyword">COMPILE</a> <a id="3868" class="Pragma">UHC</a> <a id="3872" href="IO.Primitive.html#1857" class="Postulate">putStrLn</a>       <a id="3887" class="Pragma">=</a> <a id="3889" class="Pragma">UHC.Agda.Builtins.primPutStrLn</a>        <a id="3927" class="Symbol">#-}</a>
<a id="3931" class="Symbol">{-#</a> <a id="3935" class="Keyword">COMPILE</a> <a id="3943" class="Pragma">UHC</a> <a id="3947" href="IO.Primitive.html#2012" class="Postulate">readFiniteFile</a> <a id="3962" class="Pragma">=</a> <a id="3964" class="Pragma">UHC.Agda.Builtins.primReadFiniteFile</a>  <a id="4002" class="Symbol">#-}</a>
</pre></body></html>